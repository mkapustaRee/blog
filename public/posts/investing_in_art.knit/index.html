<!doctype html>

<html lang="en">

<head>
  <title>Michal Kapusta</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="The HTML5 Herald" />
  <meta name="author" content="Michal Kapusta" />
  <meta name="generator" content="Hugo 0.31.1" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" />
  <link rel="stylesheet" type="text/css" href="/css/styles.css" />
</head>

<body>
  <div id="container">
    <header>
      <h1>
                <a href="/">Michal Kapusta</a>
            </h1>

      <ul id="social-media">
        
        <li><a href="https://twitter.com/mkapustaRee"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
         
        <li><a href="https://www.linkedin.com/in/michal-kapusta-4b178511/"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
         
        <li><a href="https://github.com/mkapustaRee"><i class="fa fa-github fa-lg" aria-hidden="true"></i></a></li>
           
      </ul>
      
      <p><em>Investment Research | R programming | Finance</em></p>
      
    </header>

    
<nav>
    <ul>
        
        <li>
            <a class="" href="/posts/">
                <i class="fa-li fa  fa-lg"></i><span>Posts</span>
            </a>
        </li>
        
        <li>
            <a class="" href="/bio/">
                <i class="fa-li fa  fa-lg"></i><span>Bio</span>
            </a>
        </li>
        
        <li>
            <a class="" href="/about/">
                <i class="fa-li fa  fa-lg"></i><span>Contact</span>
            </a>
        </li>
        
    </ul>
</nav>

    <main>




<article>

    <h1>Is fine Art a fine Investment? Let&#39;s find out using web scraping!</h1>

    
        <aside>
    <ul>
        <li>
            <time class="post-date" datetime="2018-02-26T00:00:00Z">Feb 26, 2018</time>
        </li>
        
        
        <li>
            Categories: 
            <em>
                
                    
                    <a href="/categories/r/">R</a>
                
            </em>
        </li>
        

        
        <li>
            <em>
                
                    
                    <a href="/tags/webscraping/">#Webscraping</a>
                
                    , 
                    <a href="/tags/purrr/">#Purrr</a>
                
                    , 
                    <a href="/tags/rvest/">#Rvest</a>
                
                    , 
                    <a href="/tags/plotly/">#Plotly</a>
                
                    , 
                    <a href="/tags/art/">#Art</a>
                
                    , 
                    <a href="/tags/investment/">#Investment</a>
                
            </em>
        </li>
        

        <li>17 min read</li>
    </ul>
</aside>
    

    

<h2 id="idea">Idea</h2>

<p>The inspiration to write this article was a documentary about the life of a famous “con” artist Mr. Beltracchi <a href="http://www.imdb.com/title/tt3212568/">link</a> which got me curious about art trading &amp; auctions. I often hear the media saying: <strong>“Invest in fine Art, it is a great investment!”</strong>. In the finance world, banks offer clients services such as Art Consulting. The service offers advice on buying and selling fine art. The key to a great advice is to know which Artist’s artwork is increasing in value over time and generate profits at the auctions and which one doesn’t.</p>

<p>This analysis <strong>shows evidence</strong> an art investor might use when making investment decisions based on actual transaction data. Structured transaction data, trends or patterns are non existent so in order to find them I have used handy web scraping techniques to start with. I have then analyzed the data and created interactive charts that hopefully provide insights into the world of Slovak art auctions.</p>

<h2 id="approach">Approach</h2>

<ol>
<li>Webscrape all the auctioned paintings from the SOGA auction house website  (rvest, stringr)</li>
<li>Tidy the raw data into the tidy form (tidyverse, rebus, purrr)</li>
<li>Use tidy data as base for the analysis (tidyverse)</li>
<li>Conclusions</li>
</ol>

<ul>
<li>the MVF (Most Valuable Function) is the <strong>safely()</strong> function from the package purrr!</li>
</ul>

<h3 id="part-i-the-webscrape">Part I: The webscrape</h3>

<p>The primary source of information is the website of Slovak national gallery auction house: <a href="https://www.soga.sk">https://www.soga.sk</a> (aka SOGA). The website is filled with data that can be categorized as:</p>

<ul>
<li>grouped &amp; labeled auctions (since 2005)</li>
<li>all auctioned items are listed<br /></li>
<li>artist, artwork name, starting price, final price data are listed</li>
</ul>

<p>Before we start web scraping process the website has to allow this behavior. More information about using robot.txt <a href="https://towardsdatascience.com/functions-with-r-and-rvest-a-laymens-guide-acda42325a77">here</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#f92672">library</span>(robotstxt)</code></pre></div>
<pre><code>## Warning: package 'robotstxt' was built under R version 3.4.3
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">robotstxt<span style="color:#f92672">::</span>robotstxt(<span style="color:#e6db74">&#34;soga.sk&#34;</span>) <span style="color:#f92672">%&gt;%</span> <span style="color:#66d9ef">print</span>()</code></pre></div>
<pre><code>## $domain
## [1] &quot;soga.sk&quot;
## 
## $text
## # robots.txt file for http://www.soga.sk
## 
## User-agent: *
## Disallow:
## 
## $bots
## [1] &quot;*&quot;
## 
## $comments
##   line                                  comment
## 1    1 # robots.txt file for http://www.soga.sk
## 
## $permissions
##      field useragent value
## 1 Disallow         *      
## 
## $crawl_delay
## [1] field     useragent value    
## &lt;0 rows&gt; (or 0-length row.names)
## 
## $host
## [1] field     useragent value    
## &lt;0 rows&gt; (or 0-length row.names)
## 
## $sitemap
## [1] field     useragent value    
## &lt;0 rows&gt; (or 0-length row.names)
## 
## $other
## [1] field     useragent value    
## &lt;0 rows&gt; (or 0-length row.names)
## 
## $robexclobj
## &lt;Robots Exclusion Protocol Object&gt;
## $check
## function (paths = &quot;/&quot;, bot = &quot;*&quot;) 
## {
##     spiderbar::can_fetch(obj = self$robexclobj, path = paths, 
##         user_agent = bot)
## }
## &lt;environment: 0x7f8b29d39470&gt;
## 
## attr(,&quot;class&quot;)
## [1] &quot;robotstxt&quot;
</code></pre>

<p>Great! The website enables the scraping of the data.</p>

<p>First step is to gather the data and build a database that contains all the data available from the website.</p>

<p>Next step is to identify the elements we want to scape. Selectorgadget identifies web elements containing auction information.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">url <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;http://www.soga.sk/aukcie-obrazy-diela-umenie-starozitnosti/aukcie/vysledky-aukcii&#34;</span>

result <span style="color:#f92672">&lt;-</span> url <span style="color:#f92672">%&gt;%</span> read_html() <span style="color:#f92672">%&gt;%</span>
        html_nodes(<span style="color:#e6db74">&#34;p.results&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
        html_text()

time <span style="color:#f92672">&lt;-</span> url <span style="color:#f92672">%&gt;%</span> read_html() <span style="color:#f92672">%&gt;%</span>
        html_nodes(<span style="color:#e6db74">&#34;p.about&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
        html_text()

link <span style="color:#f92672">&lt;-</span> url <span style="color:#f92672">%&gt;%</span> read_html() <span style="color:#f92672">%&gt;%</span>
        html_nodes(<span style="color:#e6db74">&#34;h2 a&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
        html_attr(<span style="color:#e6db74">&#34;href&#34;</span>) 

df <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">cbind</span>(time, result,link) <span style="color:#f92672">%&gt;%</span> as.tibble()</code></pre></div>
<p>This chunk of code records following table:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">df <span style="color:#f92672">%&gt;%</span> <span style="color:#66d9ef">head</span>() <span style="color:#f92672">%&gt;%</span> knitr<span style="color:#f92672">::</span>kable()</code></pre></div>
<p>time                                                            result                                                                     link</p>

<hr />

<ol>
<li>zimná aukcia výtvarných diel a starožitností, 05.12.2017   Na aukcii bolo vydražených 159 diel (55%)  v celkovej hodnote 499 745 €.   /aukcie-obrazy-diela-umenie-starozitnosti/aukcie/138-zimna-aukcia-vytvarnych-diel-a-starozitnosti</li>
<li>večerná aukcia, 14.11.2017                                 Na aukcii bolo vydražených 45 diel (50%)  v celkovej hodnote 378 900 €.    /aukcie-obrazy-diela-umenie-starozitnosti/aukcie/137-vecerna-aukcia<br /></li>
<li>jesenná aukcia výtvarných diel, 26.09.2017                 Na aukcii bolo vydražených 152 diel (57%)  v celkovej hodnote 198 940 €.   /aukcie-obrazy-diela-umenie-starozitnosti/aukcie/136-jesenna-aukcia-vytvarnych-diel<br /></li>
<li>letná aukcia výtvarných diel a starožitností, 13.06.2017   Na aukcii bolo vydražených 164 diel (50%)  v celkovej hodnote 276 625 €.   /aukcie-obrazy-diela-umenie-starozitnosti/aukcie/135-letna-aukcia-vytvarnych-diel-a-starozitnosti</li>
<li>večerná aukcia, 25.04.2017                                 Na aukcii bolo vydražených 47 diel (51%)  v celkovej hodnote 665 600 €.    /aukcie-obrazy-diela-umenie-starozitnosti/aukcie/134-vecerna-aukcia<br /></li>
<li>jarná aukcia výtvarných diel, 07.03.2017                   Na aukcii bolo vydražených 129 diel (64%)  v celkovej hodnote 212 230 €.   /aukcie-obrazy-diela-umenie-starozitnosti/aukcie/133-jarna-aukcia-vytvarnych-diel<br /></li>
</ol>

<p>Perfect! The successful scrape generated the table with information about:</p>

<ul>
<li>column <strong>time</strong>: name of the action &amp; date of the auction</li>
<li>column <strong>result</strong>: # of auctioned items, % of sold items, auction turnover</li>
<li>column <strong>link</strong>: contains the weblink to the actual auction.</li>
</ul>

<p>Unfortunately, the data are still locked in the records. The Information is extracted using string manipulation (stringr, rebus) into <strong>separate</strong> columns:</p>

<ul>
<li>date of the auction</li>
<li>number and name of the auction</li>
<li>number of artwork entering auction</li>
<li>success rate of the auctions</li>
<li>overall sum of all auctioned items</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># extract time information </span>
ptrn <span style="color:#f92672">&lt;-</span>  <span style="color:#e6db74">&#34;, &#34;</span> <span style="color:#f92672">%R%</span> one_or_more(DIGIT) <span style="color:#f92672">%R%</span> <span style="color:#e6db74">&#34;.&#34;</span> <span style="color:#f92672">%R%</span> one_or_more(HEX_DIGIT) <span style="color:#f92672">%R%</span> <span style="color:#e6db74">&#34;.&#34;</span> <span style="color:#f92672">%R%</span> one_or_more(HEX_DIGIT) 
df<span style="color:#f92672">$</span>c_time <span style="color:#f92672">&lt;-</span> df<span style="color:#f92672">$</span>time <span style="color:#f92672">%&gt;%</span> str_extract(pattern <span style="color:#f92672">=</span> ptrn) <span style="color:#f92672">%&gt;%</span> str_replace(<span style="color:#e6db74">&#34;, &#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">%&gt;%</span> lubridate<span style="color:#f92672">::</span>dmy()

<span style="color:#75715e"># extract name information </span>
df<span style="color:#f92672">$</span>c_name <span style="color:#f92672">&lt;-</span> df<span style="color:#f92672">$</span>time <span style="color:#f92672">%&gt;%</span>  str_replace(ptrn,<span style="color:#e6db74">&#34;&#34;</span>) 

<span style="color:#75715e"># extract link information</span>
df<span style="color:#f92672">$</span>c_link  <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">paste0</span>(<span style="color:#e6db74">&#34;http://www.soga.sk/&#34;</span>,df<span style="color:#f92672">$</span>link)

<span style="color:#75715e"># extract percentage information</span>
ptrn_2 <span style="color:#f92672">&lt;-</span>  <span style="color:#e6db74">&#34;(&#34;</span> <span style="color:#f92672">%R%</span> one_or_more(DIGIT) <span style="color:#f92672">%R%</span> <span style="color:#e6db74">&#34;%)&#34;</span> 
df<span style="color:#f92672">$</span>c_rate <span style="color:#f92672">&lt;-</span> df<span style="color:#f92672">$</span>result <span style="color:#f92672">%&gt;%</span> str_extract(pattern <span style="color:#f92672">=</span> ptrn_2) <span style="color:#f92672">%&gt;%</span> str_replace(<span style="color:#e6db74">&#34;%&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">%&gt;%</span> <span style="color:#66d9ef">as.numeric</span>()

<span style="color:#75715e"># clean items information</span>
ptrn_3 <span style="color:#f92672">&lt;-</span>  one_or_more(DIGIT) <span style="color:#f92672">%R%</span> <span style="color:#e6db74">&#34; diel&#34;</span> 
df<span style="color:#f92672">$</span>c_items <span style="color:#f92672">&lt;-</span> df<span style="color:#f92672">$</span>result <span style="color:#f92672">%&gt;%</span> str_extract(pattern <span style="color:#f92672">=</span> ptrn_3) <span style="color:#f92672">%&gt;%</span> str_replace(<span style="color:#e6db74">&#34; diel&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">%&gt;%</span> <span style="color:#66d9ef">as.numeric</span>()

<span style="color:#75715e"># clean price information</span>
ptrn_4 <span style="color:#f92672">&lt;-</span> one_or_more(DIGIT) <span style="color:#f92672">%R%</span> SPACE <span style="color:#f92672">%R%</span> one_or_more(DIGIT) <span style="color:#f92672">%R%</span> <span style="color:#e6db74">&#34; €&#34;</span> 
df<span style="color:#f92672">$</span>c_price <span style="color:#f92672">&lt;-</span> df<span style="color:#f92672">$</span>result <span style="color:#f92672">%&gt;%</span> str_extract(pattern <span style="color:#f92672">=</span> ptrn_4) <span style="color:#f92672">%&gt;%</span>
        str_replace(<span style="color:#e6db74">&#34; &#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
        str_replace(<span style="color:#e6db74">&#34;€&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
        <span style="color:#66d9ef">as.numeric</span>()

<span style="color:#75715e"># tidy dataframe &amp; calc average price</span>
df_tidy <span style="color:#f92672">&lt;-</span> df <span style="color:#f92672">%&gt;%</span>
        select(contains(<span style="color:#e6db74">&#34;c_&#34;</span>)) <span style="color:#f92672">%&gt;%</span>
        mutate(year <span style="color:#f92672">=</span> lubridate<span style="color:#f92672">::</span>year(c_time),
               quarter <span style="color:#f92672">=</span> lubridate<span style="color:#f92672">::</span>quarter(c_time),
               qtr <span style="color:#f92672">=</span> <span style="color:#66d9ef">paste0</span>(year,<span style="color:#e6db74">&#34;.&#34;</span>,quarter),
               c_price_avg <span style="color:#f92672">=</span> c_price <span style="color:#f92672">/</span> c_items)


df_tidy <span style="color:#f92672">%&gt;%</span> 
        select(<span style="color:#f92672">-</span>year,<span style="color:#f92672">-</span>qtr,<span style="color:#f92672">-</span>quarter) <span style="color:#f92672">%&gt;%</span> 
        <span style="color:#66d9ef">head</span>() <span style="color:#f92672">%&gt;%</span>
        knitr<span style="color:#f92672">::</span>kable()</code></pre></div>
<p>c_time       c_name                                              c_link                                                                                                                  c_rate   c_items   c_price   c_price_avg</p>

<hr />

<p>2017-12-05   138. zimná aukcia výtvarných diel a starožitností   <a href="http://www.soga.sk//aukcie-obrazy-diela-umenie-starozitnosti/aukcie/138-zimna-aukcia-vytvarnych-diel-a-starozitnosti">http://www.soga.sk//aukcie-obrazy-diela-umenie-starozitnosti/aukcie/138-zimna-aukcia-vytvarnych-diel-a-starozitnosti</a>        55       159    499745      3143.050
2017-11-14   137. večerná aukcia                                 <a href="http://www.soga.sk//aukcie-obrazy-diela-umenie-starozitnosti/aukcie/137-vecerna-aukcia">http://www.soga.sk//aukcie-obrazy-diela-umenie-starozitnosti/aukcie/137-vecerna-aukcia</a>                                      50        45    378900      8420.000
2017-09-26   136. jesenná aukcia výtvarných diel                 <a href="http://www.soga.sk//aukcie-obrazy-diela-umenie-starozitnosti/aukcie/136-jesenna-aukcia-vytvarnych-diel">http://www.soga.sk//aukcie-obrazy-diela-umenie-starozitnosti/aukcie/136-jesenna-aukcia-vytvarnych-diel</a>                      57       152    198940      1308.816
2017-06-13   135. letná aukcia výtvarných diel a starožitností   <a href="http://www.soga.sk//aukcie-obrazy-diela-umenie-starozitnosti/aukcie/135-letna-aukcia-vytvarnych-diel-a-starozitnosti">http://www.soga.sk//aukcie-obrazy-diela-umenie-starozitnosti/aukcie/135-letna-aukcia-vytvarnych-diel-a-starozitnosti</a>        50       164    276625      1686.738
2017-04-25   134. večerná aukcia                                 <a href="http://www.soga.sk//aukcie-obrazy-diela-umenie-starozitnosti/aukcie/134-vecerna-aukcia">http://www.soga.sk//aukcie-obrazy-diela-umenie-starozitnosti/aukcie/134-vecerna-aukcia</a>                                      51        47    665600     14161.702
2017-03-07   133. jarná aukcia výtvarných diel                   <a href="http://www.soga.sk//aukcie-obrazy-diela-umenie-starozitnosti/aukcie/133-jarna-aukcia-vytvarnych-diel">http://www.soga.sk//aukcie-obrazy-diela-umenie-starozitnosti/aukcie/133-jarna-aukcia-vytvarnych-diel</a>                        64       129    212230      1645.194</p>

<p>Clean dataset reveals important information about auction house performance over the period of years 2001-2017.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">df_summary <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(data, <span style="color:#66d9ef">...</span>) {
        
        group_var <span style="color:#f92672">&lt;-</span> quos(<span style="color:#66d9ef">...</span>)
        
        data <span style="color:#f92672">%&gt;%</span> 
                group_by(<span style="color:#f92672">!!!</span>group_var) <span style="color:#f92672">%&gt;%</span>  
                summarise(s_price <span style="color:#f92672">=</span> <span style="color:#66d9ef">sum</span>(c_price),
                          s_items <span style="color:#f92672">=</span> <span style="color:#66d9ef">sum</span>(c_items),
                          c_price_avg <span style="color:#f92672">=</span> <span style="color:#66d9ef">mean</span>(c_price_avg)) 
        
}

<span style="color:#75715e"># chart overview</span>
df_tidy <span style="color:#f92672">%&gt;%</span>
        df_summary(year) <span style="color:#f92672">%&gt;%</span>
        rename(average_price <span style="color:#f92672">=</span> c_price_avg , 
               number_of_items <span style="color:#f92672">=</span> s_items,
               auction_turnover <span style="color:#f92672">=</span> s_price) <span style="color:#f92672">%&gt;%</span> 
        gather(Ratio, Value, <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#66d9ef">length</span>(<span style="color:#ae81ff">.</span>)) <span style="color:#f92672">%&gt;%</span> 
        ggplot(aes(year, Value, group <span style="color:#f92672">=</span> Ratio)) <span style="color:#f92672">+</span>
        geom_line(alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">.3</span>)  <span style="color:#f92672">+</span>
        theme_minimal(base_family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Verdana&#34;</span>,base_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>) <span style="color:#f92672">+</span> 
        facet_wrap(<span style="color:#f92672">~</span>Ratio,scales <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;free&#34;</span>) <span style="color:#f92672">+</span>
        tidyquant<span style="color:#f92672">::</span>geom_ma(n <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>,color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>, linetype <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span> 
        labs(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SOGA: Overview &#34;</span>,
             subtitle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;by indicator&#34;</span>, caption <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;source: www.soga.sk&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>)</code></pre></div>
<p><img src="Investing_in_Art_files/figure-html/display the results-1.png" width="672" /></p>

<p>Data shows SOGA turnover is growing steadily from 2004. Additionally, the average price per painting sold at auction is growing. Average price grew from ~1200€ to current ~5000€ in 14 years. This means either more expensive paintings are being sold or the prices of the artworks are growing. A calculation reveals 10% CAGR in prices per painting for the time period.</p>

<p>A byproduct of the scrape is the URL to every single auction in SOGA history (for example here <a href="http://www.soga.sk//aukcie-obrazy-diela-umenie-starozitnosti/aukcie/134-vecerna-aukcia">http://www.soga.sk//aukcie-obrazy-diela-umenie-starozitnosti/aukcie/134-vecerna-aukcia</a>).  This link leads to every single item auctioned at that particular auction.</p>

<p>Next step is taken in order to:</p>

<ul>
<li>scrape all the websites dedicated to listing items sold at one particular auction (user need to click several times next page in order to see all the items)</li>
<li>scrape the URLs of the particular items traded on the auction (download the individual URL link of the items)</li>
<li>scrape the details regarding starting price, final price, artwork name etc.<br /></li>
</ul>

<p>These steps can be executed using following code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">extract_auction_length      <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(<span style="color:#66d9ef">url</span>) {
        ptrn <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;page=&#34;</span> <span style="color:#f92672">%R%</span> one_or_more(DIGIT)
        
        num <span style="color:#f92672">&lt;-</span> url <span style="color:#f92672">%&gt;%</span> read_html() <span style="color:#f92672">%&gt;%</span>
                html_nodes(<span style="color:#e6db74">&#34;#auctionArtworks~ .pager .last&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
                html_attr(<span style="color:#e6db74">&#34;href&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
                str_extract(ptrn) <span style="color:#f92672">%&gt;%</span> 
                str_replace(<span style="color:#e6db74">&#34;page=&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
                <span style="color:#66d9ef">as.numeric</span>()

        df <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">paste0</span>(<span style="color:#66d9ef">url</span>,<span style="color:#e6db74">&#34;?page=&#34;</span>)
        
        df_seq <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">seq</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>num)
        
        df_final <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">paste0</span>(df,df_seq)
        <span style="color:#66d9ef">return</span>(df_final)
        
} <span style="color:#75715e"># download the auction websites urls</span>
extract_page_content        <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(<span style="color:#66d9ef">url</span>) {
        <span style="color:#66d9ef">print</span>(<span style="color:#66d9ef">url</span>)
        
        <span style="color:#66d9ef">Sys.sleep</span>(<span style="color:#66d9ef">sample</span>(<span style="color:#66d9ef">seq</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, by<span style="color:#f92672">=</span><span style="color:#ae81ff">0.001</span>), <span style="color:#ae81ff">1</span>))
        
        article_list <span style="color:#f92672">&lt;-</span> url <span style="color:#f92672">%&gt;%</span> read_html() <span style="color:#f92672">%&gt;%</span>
                html_nodes(<span style="color:#e6db74">&#34;h2&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
                html_nodes(<span style="color:#e6db74">&#34;a&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
                html_attr(<span style="color:#e6db74">&#34;href&#34;</span>) 
        
        article_list_corrected <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">paste0</span>(<span style="color:#e6db74">&#34;http://www.soga.sk&#34;</span>,
                                         article_list)
        
        <span style="color:#66d9ef">return</span>(article_list_corrected)
        
} <span style="color:#75715e"># download the auction items urls</span>
extract_article_content     <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(<span style="color:#66d9ef">url</span>) {
        <span style="color:#66d9ef">print</span>(<span style="color:#66d9ef">url</span>)
        
        <span style="color:#66d9ef">Sys.sleep</span>(<span style="color:#66d9ef">sample</span>(<span style="color:#66d9ef">seq</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, by<span style="color:#f92672">=</span><span style="color:#ae81ff">0.001</span>), <span style="color:#ae81ff">1</span>))
        

        art_name <span style="color:#f92672">&lt;-</span> url <span style="color:#f92672">%&gt;%</span> read_html() <span style="color:#f92672">%&gt;%</span> 
                html_nodes(<span style="color:#e6db74">&#34;h2 a&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
                html_text(<span style="color:#e6db74">&#34;href&#34;</span>)
        
        art_piece <span style="color:#f92672">&lt;-</span> url <span style="color:#f92672">%&gt;%</span> read_html() <span style="color:#f92672">%&gt;%</span> 
                html_nodes(<span style="color:#e6db74">&#34;.wrapper a&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
                html_text(<span style="color:#e6db74">&#34;href&#34;</span>)
        
        art_cat <span style="color:#f92672">&lt;-</span> url <span style="color:#f92672">%&gt;%</span> read_html() <span style="color:#f92672">%&gt;%</span> 
                html_nodes(<span style="color:#e6db74">&#34;.col1&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
                html_text(<span style="color:#e6db74">&#34;href&#34;</span>) <span style="color:#f92672">%&gt;%</span> as.tibble()
        
        art_values <span style="color:#f92672">&lt;-</span> url <span style="color:#f92672">%&gt;%</span> read_html() <span style="color:#f92672">%&gt;%</span> 
                html_nodes(<span style="color:#e6db74">&#34;.col2&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
                html_text(<span style="color:#e6db74">&#34;href&#34;</span>) <span style="color:#f92672">%&gt;%</span> as.tibble()
        
        art_df <span style="color:#f92672">&lt;-</span> bind_cols(art_cat,art_values) <span style="color:#f92672">%&gt;%</span> as.tibble()
        
        art_df<span style="color:#f92672">$</span>name  <span style="color:#f92672">&lt;-</span> art_name
        art_df<span style="color:#f92672">$</span>piece <span style="color:#f92672">&lt;-</span> art_piece
        
        <span style="color:#66d9ef">return</span>(art_df)
        
        
} <span style="color:#75715e"># download the auction item content</span>

df_all_pages                <span style="color:#f92672">&lt;-</span> map(df<span style="color:#f92672">$</span>c_link,extract_auction_length) <span style="color:#f92672">%&gt;%</span> <span style="color:#66d9ef">unlist</span>()

df_all_pages_content        <span style="color:#f92672">&lt;-</span> map(df_all_pages,extract_page_content) <span style="color:#f92672">%&gt;%</span> <span style="color:#66d9ef">unlist</span>()

df_all_pages_content_vec    <span style="color:#f92672">&lt;-</span> df_all_pages_content <span style="color:#f92672">%&gt;%</span> pull()

df_all_article_content_sf   <span style="color:#f92672">&lt;-</span> map(df_all_pages_content_vec,safely(extract_article_content))</code></pre></div>
<h3 id="part-ii-raw-data-into-tidy-data">Part II: Raw data into tidy data</h3>

<p>The downloaded wide raw data have the following structure:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">df_soga <span style="color:#f92672">&lt;-</span> df_soga <span style="color:#f92672">%&gt;%</span>
        rename(variable <span style="color:#f92672">=</span> value, value <span style="color:#f92672">=</span> value1) <span style="color:#f92672">%&gt;%</span> 
        drop_na()  
str(df_soga)</code></pre></div>
<pre><code>## Classes 'tbl_df', 'tbl' and 'data.frame':	47635 obs. of  4 variables:
##  $ variable: chr  &quot;Poradové číslo:&quot; &quot;Vyvolávacia cena:&quot; &quot;Konečná cena:&quot; &quot;Poradové číslo:&quot; ...
##  $ value   : chr  &quot;1&quot; &quot;400 €&quot; &quot;320 €&quot; &quot;2&quot; ...
##  $ name    : chr  &quot;CPIN ŠTEFAN (1919 - 1971)&quot; &quot;CPIN ŠTEFAN (1919 - 1971)&quot; &quot;CPIN ŠTEFAN (1919 - 1971)&quot; &quot;HÁLA JAN (1890 - 1959)&quot; ...
##  $ piece   : chr  &quot;Dievča&quot; &quot;Dievča&quot; &quot;Dievča&quot; &quot;Dievča na lúke (Leto)&quot; ...
</code></pre>

<p>The <strong>variable column</strong> contains the following information:</p>

<ul>
<li>Article Number (Poradové číslo)</li>
<li>Starting Price (Vyvolávacia cena)</li>
<li>Final Price (Konečná cena)</li>
</ul>

<p>Importantly, everyday items (such as sculptures) are sold besides paintings. These items will be removed as they are not the target of this analysis.</p>

<p>For more broader audience I will translate the collum names into the English language.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">df_soga<span style="color:#f92672">$</span>variable <span style="color:#f92672">&lt;-</span> if_else(df_soga<span style="color:#f92672">$</span>variable <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Cena v predaji:&#34;</span>, <span style="color:#e6db74">&#34;sale_price&#34;</span>,
                         if_else(df_soga<span style="color:#f92672">$</span>variable <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Konečná cena:&#34;</span>, <span style="color:#e6db74">&#34;final_price&#34;</span>,
                          if_else(df_soga<span style="color:#f92672">$</span>variable <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Nevydražené&#34;</span>, <span style="color:#e6db74">&#34;unsold&#34;</span>,
                          if_else(df_soga<span style="color:#f92672">$</span>variable <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Odhadovaná cena:&#34;</span>, <span style="color:#e6db74">&#34;assumed_price&#34;</span>,
                          if_else(df_soga<span style="color:#f92672">$</span>variable <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Poradové číslo:&#34;</span>, <span style="color:#e6db74">&#34;item_number&#34;</span>,
                          if_else(df_soga<span style="color:#f92672">$</span>variable <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Vyvolávacia cena:&#34;</span>, <span style="color:#e6db74">&#34;starting_price&#34;</span>,df_soga<span style="color:#f92672">$</span>variable)))))) <span style="color:#75715e"># works but looks ugly - sorry folks</span></code></pre></div>
<p>The code above is five times nested if_else command - something I am not particularly proud of. It might be a more elegant way to code this but I haven&rsquo;t found it yet.</p>

<p>Next step is to create an ID columns that identify author &amp; artwork and spread the data from long to wide - in line with the <strong>tidy data</strong> <a href="https://www.google.de/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;ved=0ahUKEwjcwpnQ_fjYAhVPyqQKHf05AVMQFggqMAA&amp;url=https%3A%2F%2Fwww.jstatsoft.org%2Farticle%2Fview%2Fv059i10%2Fv59i10.pdf&amp;usg=AOvVaw2vJ6CHw9RT8m_noVUfoeP6">manifest</a> written by Hadely Wickham.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">df_soga_wide <span style="color:#f92672">&lt;-</span> df_soga <span style="color:#f92672">%&gt;%</span>
        mutate(id <span style="color:#f92672">=</span> <span style="color:#66d9ef">paste</span>(name, piece)) <span style="color:#f92672">%&gt;%</span>  <span style="color:#75715e"># create unique id per row</span>
        <span style="color:#66d9ef">split</span>(<span style="color:#ae81ff">.</span><span style="color:#f92672">$</span>id) <span style="color:#f92672">%&gt;%</span>  <span style="color:#75715e"># split the data per unique artwork</span>
        map(safely(spread),variable, value) <span style="color:#f92672">%&gt;%</span> <span style="color:#75715e"># spread the values - use safely to prevent errors</span>
        map_df(<span style="color:#e6db74">&#34;result&#34;</span>) <span style="color:#75715e"># filter list with suscessfull results </span>

glimpse(df_soga_wide)</code></pre></div>
<p>Now, we have one row per piece and variables stored in columns. This enables a quick and consistent way of working the data. Let&rsquo;s take a glimpse into the data and let&rsquo;s find out the most frequently sold author at the auction house.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">df_soga_wide<span style="color:#f92672">$</span>name <span style="color:#f92672">%&gt;%</span>
        <span style="color:#66d9ef">table</span>() <span style="color:#f92672">%&gt;%</span>
        as.tibble() <span style="color:#f92672">%&gt;%</span>
        arrange(desc(n)) <span style="color:#f92672">%&gt;%</span> 
        set_names(<span style="color:#66d9ef">c</span>(<span style="color:#e6db74">&#34;artist&#34;</span>, <span style="color:#e6db74">&#34;count&#34;</span>)) <span style="color:#f92672">%&gt;%</span> 
        top_n(<span style="color:#ae81ff">10</span>) <span style="color:#f92672">%&gt;%</span> 
        knitr<span style="color:#f92672">::</span>kable()</code></pre></div>
<pre><code>## Selecting by count
</code></pre>

<p>artist                                count</p>

<hr />

<p>NEZNÁMY STREDOEURÓPSKY MALIAR           349
MEDNYÁNSZKY LADISLAV (1852 - 1919)      186
BENKA MARTIN (1888 - 1971)              161
HLOŽNÍK VINCENT (1919 - 1997)           151
ZMETÁK ERNEST (1919 - 2004)             133
MEDVECKÁ MÁRIA (1914 - 1987)            119
WEINER-KRÁĽ IMRO (1901 - 1978)          118
Mednyánszky Ladislav (1852 – 1919)      117
KOMPÁNEK VLADIMÍR (1927 - 2011)         111
HÁLA JAN (1890 - 1959)                  108</p>

<p>Great! Now we see that the most frequently sold artist was an unknown central European artist with around 360 sold paintings.</p>

<p>Unfortunately the data is still not tidy. My poorly written web scraping code is responsible for this messy dataset. (I am sure there is a better R code to scrape data more accurately)</p>

<p>Now, lets tidy up columns containing the messy data. Columns are still character variables and errors prohibiting transformation into tidy are:</p>

<ul>
<li>Columns with price data contains symbols currency symbol €</li>
<li>Blank space before, after and in between the values</li>
<li>Date of birth &amp; death of the artist are not in separate columns</li>
<li>Name of the artist contains his living years</li>
</ul>

<p>Let&rsquo;s remove the errors using string manipulation techniques!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># tidy the columns with variables containing price informations</span>

df_soga_tidy <span style="color:#f92672">&lt;-</span> df_soga_wide <span style="color:#f92672">%&gt;%</span>
        modify_at(<span style="color:#66d9ef">c</span>(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span>), <span style="color:#f92672">~</span> str_replace_all(<span style="color:#ae81ff">.</span>,<span style="color:#e6db74">&#34;€&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>)) <span style="color:#f92672">%&gt;%</span> <span style="color:#75715e"># modify_at helps identify collums more efficiently then naming them using mutate</span>
        modify_at(<span style="color:#66d9ef">c</span>(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span>), <span style="color:#f92672">~</span> str_replace_all(<span style="color:#ae81ff">.</span>,<span style="color:#e6db74">&#34; &#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>)) <span style="color:#f92672">%&gt;%</span> 
        modify_at(<span style="color:#66d9ef">c</span>(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span>), <span style="color:#f92672">~</span> str_replace_all(<span style="color:#ae81ff">.</span>,<span style="color:#e6db74">&#34;Neurčená&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>)) <span style="color:#f92672">%&gt;%</span> 
        modify_at(<span style="color:#66d9ef">c</span>(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span>), <span style="color:#f92672">~</span> str_replace_all(<span style="color:#ae81ff">.</span>,<span style="color:#e6db74">&#34;,&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>)) <span style="color:#f92672">%&gt;%</span> 
        modify_at(<span style="color:#66d9ef">c</span>(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span>), <span style="color:#f92672">~</span> str_replace_all(<span style="color:#ae81ff">.</span>,<span style="color:#e6db74">&#34;EUR&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>)) <span style="color:#f92672">%&gt;%</span> 
        modify_at(<span style="color:#66d9ef">c</span>(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span>), <span style="color:#f92672">~</span> str_trim(<span style="color:#ae81ff">.</span>)) <span style="color:#f92672">%&gt;%</span> 
        modify_at(<span style="color:#66d9ef">c</span>(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span>), <span style="color:#66d9ef">as.numeric</span>)  

<span style="color:#75715e"># tidy the column names </span>
<span style="color:#66d9ef">colnames</span>(df_soga_tidy) <span style="color:#f92672">&lt;-</span> df_soga_tidy <span style="color:#f92672">%&gt;%</span> 
                        <span style="color:#66d9ef">colnames</span>() <span style="color:#f92672">%&gt;%</span>
                        str_to_lower() <span style="color:#f92672">%&gt;%</span>
                        str_replace_all(<span style="color:#e6db74">&#34;:&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">%&gt;%</span>
                        str_replace_all(<span style="color:#e6db74">&#34; &#34;</span>,<span style="color:#e6db74">&#34;_&#34;</span>)

<span style="color:#75715e"># tidy the date of birth &amp; death into two separate collumns</span>
living_years <span style="color:#f92672">&lt;-</span> str_extract_all(df_soga_tidy<span style="color:#f92672">$</span>name, one_or_more(DIGIT),simplify <span style="color:#f92672">=</span> T) <span style="color:#f92672">%&gt;%</span> 
        as.tibble() <span style="color:#f92672">%&gt;%</span> 
        set_names(<span style="color:#66d9ef">c</span>(<span style="color:#e6db74">&#34;birth_year&#34;</span>,<span style="color:#e6db74">&#34;death_year&#34;</span>,<span style="color:#e6db74">&#34;birth_year_I&#34;</span>,<span style="color:#e6db74">&#34;death_year_I&#34;</span>)) <span style="color:#f92672">%&gt;%</span> 
        select(<span style="color:#e6db74">&#34;birth_year&#34;</span>,<span style="color:#e6db74">&#34;death_year&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
        modify_if(<span style="color:#66d9ef">is.character</span>, <span style="color:#66d9ef">as.numeric</span>)


df_soga_tidy <span style="color:#f92672">&lt;-</span> df_soga_tidy <span style="color:#f92672">%&gt;%</span> 
                bind_cols(living_years)

<span style="color:#75715e"># remove years from name column</span>
df_soga_tidy<span style="color:#f92672">$</span>name <span style="color:#f92672">&lt;-</span> df_soga_tidy<span style="color:#f92672">$</span>name <span style="color:#f92672">%&gt;%</span> 
        str_replace_all(pattern <span style="color:#f92672">=</span> DIGIT,<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
        str_replace_all(<span style="color:#e6db74">&#34;\\)&#34;</span>,<span style="color:#e6db74">&#34; &#34;</span>) <span style="color:#f92672">%&gt;%</span>
        str_replace_all(<span style="color:#e6db74">&#34;\\(&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">%&gt;%</span>
        str_replace_all(<span style="color:#e6db74">&#34;-&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
        str_replace_all(<span style="color:#e6db74">&#34;–&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
        str_trim() <span style="color:#f92672">%&gt;%</span> 
        str_to_upper()

<span style="color:#75715e"># tidy &amp; include assumed_price in the final price</span>
df_assumed_price_tidy <span style="color:#f92672">&lt;-</span> df_soga_tidy<span style="color:#f92672">$</span>assumed_price <span style="color:#f92672">%&gt;%</span> 
        str_replace_all(<span style="color:#e6db74">&#34;-&#34;</span>, <span style="color:#e6db74">&#34;/&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
        str_replace_all(<span style="color:#e6db74">&#34;– &#34;</span>,<span style="color:#e6db74">&#34;/&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
        str_replace_all(<span style="color:#e6db74">&#34;€&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
        str_replace_all(<span style="color:#e6db74">&#34;EUR&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
        str_replace_all(<span style="color:#e6db74">&#34;,00&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
        str_replace_all(<span style="color:#e6db74">&#34;,&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
        str_replace_all(space(),<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
        str_split(<span style="color:#e6db74">&#34;/&#34;</span>,simplify <span style="color:#f92672">=</span> T) <span style="color:#f92672">%&gt;%</span> 
        as.tibble() <span style="color:#f92672">%&gt;%</span> 
        modify(<span style="color:#66d9ef">as.numeric</span>) <span style="color:#f92672">%&gt;%</span> 
        mutate(assumed_price <span style="color:#f92672">=</span> (V1 <span style="color:#f92672">+</span> V2) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">%&gt;%</span> 
        select(assumed_price) 

df_soga_tidy <span style="color:#f92672">&lt;-</span> bind_cols(dplyr<span style="color:#f92672">::</span>select(df_soga_tidy, <span style="color:#f92672">-</span>assumed_price),
                          df_assumed_price_tidy) 


df_soga_tidy <span style="color:#f92672">%&gt;%</span> glimpse()</code></pre></div>
<pre><code>## Observations: 15,978
## Variables: 10
## $ name           &lt;chr&gt; &quot;/JIŘÍ/ GEORG DOKOUPIL&quot;, &quot;A D.WEGENER   ?&quot;, &quot;A....
## $ piece          &lt;chr&gt; &quot;Erotický motív&quot;, &quot;Horská krajina&quot;, &quot;Česká kraj...
## $ id             &lt;chr&gt; &quot;/JIŘÍ/ GEORG DOKOUPIL (1954) Erotický motív&quot;, ...
## $ item_number    &lt;chr&gt; &quot;154&quot;, &quot;178&quot;, &quot;291&quot;, &quot;207&quot;, &quot;201&quot;, &quot;192&quot;, &quot;214&quot;...
## $ starting_price &lt;dbl&gt; 465, 929, 597, 996, 1062, 398, 664, 597, 830, 4...
## $ final_price    &lt;dbl&gt; NA, NA, NA, 1394, NA, NA, NA, 597, NA, NA, 1461...
## $ sale_price     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ birth_year     &lt;dbl&gt; 1954, 1891, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ death_year     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ assumed_price  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
</code></pre>

<p>Much better!!! With the above-written code we have achieved:</p>

<ul>
<li>name more variable contains just the name of the artist</li>
<li>birth_year, death_year column created</li>
<li>assumed price now contains mean value of the range stated</li>
<li>numeric vector instead of character vector in the columns containing information about price</li>
</ul>

<p>Since we have some tidy data now, let&rsquo;s create some new ratios.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">df_soga_tidy <span style="color:#f92672">&lt;-</span> df_soga_tidy <span style="color:#f92672">%&gt;%</span> 
        mutate(starting_price <span style="color:#f92672">=</span> if_else(<span style="color:#66d9ef">is.na</span>(starting_price), assumed_price, <span style="color:#66d9ef">as.numeric</span>(starting_price)), <span style="color:#75715e"># if variable starting_price is NA use assumed_price instead </span>
                diff_price_rel <span style="color:#f92672">=</span> ((final_price <span style="color:#f92672">-</span> starting_price) <span style="color:#f92672">/</span> (starting_price)), <span style="color:#75715e"># relative difference between starting price and final price</span>
               diff_price_abs <span style="color:#f92672">=</span> final_price <span style="color:#f92672">-</span> starting_price ,  <span style="color:#75715e"># absolute difference between starting price and final price</span>
               bin_price <span style="color:#f92672">=</span> ntile(starting_price, <span style="color:#ae81ff">4</span>),  <span style="color:#75715e"># create bins by starting price </span>
               bin_diff_price_rel <span style="color:#f92672">=</span> ntile(diff_price_rel, <span style="color:#ae81ff">4</span>)) <span style="color:#75715e"># create bins by relative profit &amp; losses</span></code></pre></div>
<h3 id="part-iii-analysis-of-the-data">Part III: Analysis of the data</h3>

<p>With tidy data lets focus on analyzing the data. Once the data has been cleaned up analysis can be performed. This part is always a cherry on the cake after the painful process of data gathering &amp; cleaning. (Jenny Bryans quote: “Behind every great plot there’s a great deal of wrangling”) - is an accurate one. Link <a href="https://www.youtube.com/watch?v=4MfUCX_KpdE">here</a></p>

<p>First, let’s look at the highest prices paid for painting on auction:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">df_soga_tidy <span style="color:#f92672">%&gt;%</span> 
        drop_na(final_price) <span style="color:#f92672">%&gt;%</span> 
        top_n(wt <span style="color:#f92672">=</span> final_price,n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>) <span style="color:#f92672">%&gt;%</span> 
        ggplot(aes(reorder(piece, final_price),final_price)) <span style="color:#f92672">+</span>
        geom_col() <span style="color:#f92672">+</span>
        coord_flip() <span style="color:#f92672">+</span> 
        labs(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Highest price paid per painting&#34;</span>,
             caption <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Source: www.soga.sk&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Final Price in €&#34;</span>, x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Artwork&#34;</span>) <span style="color:#f92672">+</span> 
        theme_minimal(base_family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Verdana&#34;</span>,base_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>)  <span style="color:#f92672">+</span> 
        scale_y_continuous(labels <span style="color:#f92672">=</span> scales<span style="color:#f92672">::</span>comma) <span style="color:#f92672">+</span>
        theme(legend.text  <span style="color:#f92672">=</span> element_text(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>),
                legend.title <span style="color:#f92672">=</span> element_text(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>),legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>)</code></pre></div>
<p><img src="Investing_in_Art_files/figure-html/highest price per painting-1.png" width="672" /></p>

<p>The highest auctioned painting was for the “Chlapec s Dalmatinom” by DOMENICHINO DOMENICO ZAMPIERI. Interestingly it failed to reach its owner price of 663 878 EUR and was sold at a loss of (-132 775 EUR or -19%) for final price of 531 103 EUR.</p>

<p>The second chart shows paintings sold at the highest <strong>relative</strong> profit:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">df_soga_tidy <span style="color:#f92672">%&gt;%</span> 
        drop_na(diff_price_rel) <span style="color:#f92672">%&gt;%</span> 
        top_n(wt <span style="color:#f92672">=</span> diff_price_rel,n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>) <span style="color:#f92672">%&gt;%</span> 
        ggplot(aes(reorder(piece, diff_price_rel),diff_price_rel)) <span style="color:#f92672">+</span>
        geom_col() <span style="color:#f92672">+</span>
        coord_flip() <span style="color:#f92672">+</span> 
        theme_minimal(base_family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Verdana&#34;</span>,base_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>) <span style="color:#f92672">+</span> 
        labs(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Highest profit generated by painting (in %)&#34;</span>,
             y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Profit (in %)&#34;</span>,
             x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Artwork&#34;</span>,
             caption <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Source: www.soga.sk&#34;</span>) <span style="color:#f92672">+</span> 
        scale_y_continuous(labels <span style="color:#f92672">=</span> scales<span style="color:#f92672">::</span>percent) </code></pre></div>
<p><img src="Investing_in_Art_files/figure-html/highest profit per painting - relative-1.png" width="672" /></p>

<p>Surprisingly, the highest profits were in the range of 10x - 15x fold return. This is a great result for the investor. The most profitable painting was - &ldquo;Zátišie s ľudovým džbánom&rdquo; by KRIVOŠ RUDOLF ( <a href="http://www.soga.sk/aukcie-obrazy-diela-umenie-starozitnosti/aukcie/102-jarna-aukcia-vytvarnych-diel/krivos-rudolf-zatisie-s-ludovym-dzbanom-30005">link</a>
). This painting was also an outlier as rest of KRIVOŠ paintings generated far lower returns.</p>

<p>Another point of view is to visualize the most profitable paintings in the <strong>absolute</strong> terms.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">df_soga_tidy <span style="color:#f92672">%&gt;%</span> 
        drop_na(diff_price_abs) <span style="color:#f92672">%&gt;%</span> 
        top_n(wt <span style="color:#f92672">=</span> diff_price_abs,n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>) <span style="color:#f92672">%&gt;%</span> 
        ggplot(aes(reorder(piece, diff_price_abs),diff_price_abs)) <span style="color:#f92672">+</span>
        geom_col() <span style="color:#f92672">+</span>
        coord_flip() <span style="color:#f92672">+</span> 
        theme_minimal(base_family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Verdana&#34;</span>,base_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>) <span style="color:#f92672">+</span> 
        labs(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Highest profit generated by painting (in €)&#34;</span>,
             y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Profit (in €)&#34;</span>,
             x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Painting&#34;</span>,
             caption <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Source: www.soga.sk&#34;</span>) <span style="color:#f92672">+</span> 
        scale_y_continuous(labels <span style="color:#f92672">=</span> scales<span style="color:#f92672">::</span>comma) </code></pre></div>
<p><img src="Investing_in_Art_files/figure-html/highest profit per painting - absolute-1.png" width="672" /></p>

<p>Painting <strong>V žatve</strong> was the paiting sold at the highest profit of about 85 000 EUR. This is an equivalent of the price paid for small 1 bedroom flat in Bratislava.</p>

<p>Now, let&rsquo;s visualize the result of the SOGA auctions:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">df_loss_profit <span style="color:#f92672">&lt;-</span> df_soga_tidy <span style="color:#f92672">%&gt;%</span> 
        drop_na(final_price, bin_price)


pl <span style="color:#f92672">&lt;-</span> plotly<span style="color:#f92672">::</span>plot_ly(df_loss_profit,
                x <span style="color:#f92672">=</span> <span style="color:#f92672">~</span>starting_price,
                y <span style="color:#f92672">=</span> <span style="color:#f92672">~</span> final_price,
                size <span style="color:#f92672">=</span> <span style="color:#f92672">~</span> final_price,
                color <span style="color:#f92672">=</span> <span style="color:#f92672">~</span> bin_diff_price_rel,
                text <span style="color:#f92672">=</span> <span style="color:#f92672">~</span><span style="color:#66d9ef">paste</span>(<span style="color:#e6db74">&#34;Name: &#34;</span>, name, <span style="color:#e6db74">&#34;\n&#34;</span>,
                              <span style="color:#e6db74">&#34;Artwork:&#34;</span>,piece,<span style="color:#e6db74">&#34;\n&#34;</span>,
                              <span style="color:#e6db74">&#34;Starting Price: &#34;</span>, scales<span style="color:#f92672">::</span>comma(starting_price), <span style="color:#e6db74">&#34;\n&#34;</span>,
                              <span style="color:#e6db74">&#34;Final Price:&#34;</span>,scales<span style="color:#f92672">::</span>comma(final_price),<span style="color:#e6db74">&#34;\n&#34;</span>,
                              <span style="color:#e6db74">&#34;Return (%):&#34;</span>,scales<span style="color:#f92672">::</span>percent(diff_price_rel),<span style="color:#e6db74">&#34;\n&#34;</span>,
                              <span style="color:#e6db74">&#34;Return (€):&#34;</span>, scales<span style="color:#f92672">::</span>comma(diff_price_abs))) <span style="color:#f92672">%&gt;%</span>
  layout(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Profits &amp; Losses @ SOGA Auction House&#34;</span>, 
         xaxis <span style="color:#f92672">=</span> <span style="color:#66d9ef">list</span>(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Starting Price&#34;</span>,range <span style="color:#f92672">=</span> <span style="color:#66d9ef">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">200000</span>)),
         yaxis <span style="color:#f92672">=</span> <span style="color:#66d9ef">list</span>(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Final Price&#34;</span>,range <span style="color:#f92672">=</span> <span style="color:#66d9ef">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">200000</span>)))

widgetframe<span style="color:#f92672">::</span>frameWidget(pl,width <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;100%&#34;</span>,height <span style="color:#f92672">=</span> <span style="color:#ae81ff">550</span>)</code></pre></div>
<p><!--html_preserve--><div id="htmlwidget-a8bb5346da2b95f1a5a5" style="width:100%;height:550px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-a8bb5346da2b95f1a5a5">{&ldquo;x&rdquo;:{&ldquo;url&rdquo;:&ldquo;Investing_in_Art_files/figure-html//widgets/widget_chart I - Loses &amp; Profits.html&rdquo;,&ldquo;options&rdquo;:{&ldquo;xdomain&rdquo;:&rdquo;*&ldquo;,&ldquo;allowfullscreen&rdquo;:false,&ldquo;lazyload&rdquo;:false}},&ldquo;evals&rdquo;:[],&ldquo;jsHooks&rdquo;:[]}</script><!--/html_preserve--></p>

<p>After playing the the HTML widget for few minutes i have several observation. Some paintings failed to meet the expectation and were traded well below the asking price. Also important to note is that profits are getting smaller the more expensive the painting is.</p>

<p>Here is summary statistics with the most profitable artist sold at the SOGA auction house.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">df_soga_tidy <span style="color:#f92672">%&gt;%</span> 
        drop_na(final_price,diff_price_rel,diff_price_abs) <span style="color:#f92672">%&gt;%</span> 
        group_by(name) <span style="color:#f92672">%&gt;%</span> 
        summarise(profit_relative <span style="color:#f92672">=</span> median(diff_price_rel, na.rm <span style="color:#f92672">=</span> T) <span style="color:#f92672">%&gt;%</span> scales<span style="color:#f92672">::</span>percent(),
                  profit_absolute <span style="color:#f92672">=</span> median(diff_price_abs, na.rm <span style="color:#f92672">=</span> T) <span style="color:#f92672">%&gt;%</span> scales<span style="color:#f92672">::</span>comma(),
                  artwork_price <span style="color:#f92672">=</span> median(final_price, na.rm <span style="color:#f92672">=</span> T) <span style="color:#f92672">%&gt;%</span> scales<span style="color:#f92672">::</span>comma(),
                  count <span style="color:#f92672">=</span> n(),
                  sum <span style="color:#f92672">=</span> <span style="color:#66d9ef">sum</span>(diff_price_abs)) <span style="color:#f92672">%&gt;%</span> 
        filter(count <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">%&gt;%</span> 
        arrange(desc(profit_relative)) <span style="color:#f92672">%&gt;%</span> 
        dplyr<span style="color:#f92672">::</span>top_n(wt <span style="color:#f92672">=</span> profit_relative, n <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>) <span style="color:#f92672">%&gt;%</span> 
        knitr<span style="color:#f92672">::</span>kable()</code></pre></div>
<p>name                       profit_relative   profit_absolute   artwork_price    count     sum</p>

<hr />

<p>LADISLAV GUDERNA           87.7%             2,257             4,149                7   11284
EDITA SPANNEROVÁ           86.7%             249               713.5                8    2754
BIZMAYER IGNÁC             85.6%             325               1,325               14    7820
STRUHÁR ALOJZ              8.33%             25                310                  6     200
MARTIN SEDLÁK              8.28%             66                1,062                7     631
ZBYNĚK PROKOP              76.5%             50.5              116.5                6     302
JÚLIUS JAKOBY              74.2%             3,071             7,800.5              6   16000
FRANTIŠEK LIPTÁK           7.93%             100               746.5               12    1661
VINCENT HLOŽNÍK            7.49%             132               1,461               19   14736
DÁVID BAFFI                66%               49.5              99.5                 6     397
JOZEF JANKOVIČ             64%               531               1,759                9   15469
FRANTIŠEK REICHENTÁL       62.5%             132               1,162                9   11021
KĽÚČIK PETER               60%               90                240                 17    6700
MILOŠ ALEXANDER BAZOVSKÝ   6.31%             67                3,485               21   26457
KERN PETER JÚLIUS          5.56%             10                470                 10     730</p>

<p>The table shows results sorted by the highest median relative profit. In other words - artist generating highest profits per painting is at the top. Based on this table Ladislav Guderna paintings generated average profit of 87%. The author was traded 7x times. Average price per painting was 4 149 EUR generating profit of 2 257 EUR. The total sum of profits generated by Guderna reached 11 284 EUR.</p>

<p>Similarly below are the authors generating the highest <strong>absolute</strong> profits.</p>

<p>name                         profit_relative   profit_absolute   artwork_price    count      sum</p>

<hr />

<p>BENKA MARTIN                 2.11%             100               9,700              109   332550
HÁLA JAN                     0%                0                 5,800               86   182950
MEDNYÁNSZKY LADISLAV         0%                0                 3,500              208   153835
ĽUDOVÍT FULLA                2.71%             49.5              630.5               30    96959
ANTON JASUSCH                22.9%             498               5,394               28    62938
BAZOVSKÝ MILOŠ ALEXANDER     0%                0                 5,200               57    61050
FULLA ĽUDOVÍT                12.5%             50                600                 45    50640
JAKOBY JÚLIUS                -1.52%            -400              31,000              16    50500
WEISZKUBÍNČAN PETER ARNOLD   2.78%             50                2,850               12    44900
MOUSSON JOZEF TEODOR         0%                0                 6,850               40    44360
PAŠTÉKA MILAN                0%                0                 800                 53    41715
LALUHA MILAN                 0%                0                 1,032.5             62    40175
MIKULÁŠ GALANDA              20%               99.5              647.5               16    39698
MILOŠ ALEXANDER BAZOVSKÝ     6.31%             67                3,485               21    26457
LADISLAV MEDNYÁNSZKY         1.11%             33                2,539               36    24595</p>

<p>Not suprisingly, <strong>Martin Benka</strong> paintings generated highest profit at the auctions.  <a href="https://sk.wikipedia.org/wiki/Martin_Benka">Wiki page</a></p>

<p>PS: The results are filtered with the condition of the artist selling at least 5 paintings trough SOGA to limit the number of records and filter out paintings that don’t generate enough liquidity. Owning artwork of authors that are rarely traded presents a risk for the investor and is recommended to avoid.</p>

<h2 id="conclusions">Conclusions</h2>

<ul>
<li>Average price per painting has been increasing by 10% per annum over the past 15 years<br /></li>
<li>Purchasing famous painter does not always guarantee a good investment.<br /></li>
<li>Gudena, Spannerová or Ignác artwork generated consistently the highest returns ~ 80% per painting</li>
<li>Highest absolute profit was recorded by the artist Benka (ca 332.000€) followed by Ján Halla (ca 185.000€) or Ladislav Mednyánszky (174.000€)</li>
</ul>

<h2 id="known-limitations">Known limitations</h2>

<ul>
<li>The analysis would be more accurate if the names of the authors were labeled consistently (to avoid duplicate records for the same artist)</li>
<li>Profits are calculated based on the auction asking price, which might not reflect actual profit for the owner</li>
</ul>


</article>


<section class="post-nav">
    <ul>
        
        <li>
            <a href="/posts/investing_in_art.utf8/"><i class="fa fa-chevron-circle-left"></i> Is fine Art a fine Investment? Let&#39;s find out using web scraping!</a>
        </li>
        
        
        <li>
            <a href="/posts/investing_in_art/">Is fine Art a fine Investment? Let&#39;s find out using web scraping! <i class="fa fa-chevron-circle-right"></i> </a>
        </li>
        
    </ul>
</section>
    





</main>
    <footer>
        <h6>Copyright &copy; 2017 - Michal Kapusta | 
            Rendered by <a href="https://gohugo.io" title="Hugo">Hugo</a> |
            <a href="/index.xml">Subscribe</a></h6>
    </footer>
</div>
<script src="/js/scripts.js"></script>
</body>

</html>